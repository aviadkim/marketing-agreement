<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הסכם שיווק השקעות - הצהרות</title>
    <link href="../../css/styles.css" rel="stylesheet">
</head>
<body>
    <!-- Header with Logo -->
    <header class="form-header">
        <img src="../../images/movne-logo.png" alt="מובנה" class="logo">
        <h1>הסכם שיווק השקעות חד פעמי למוצרים מובנים</h1>
    </header>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-steps">
            <div class="step completed" data-step="1">
                <div class="step-circle">
                    <span class="step-number">1</span>
                    <span class="step-check">✓</span>
                </div>
                <div class="step-label">פרטים אישיים</div>
                <div class="step-time">כ-2 דקות</div>
            </div>
            <div class="step completed" data-step="2">
                <div class="step-circle">
                    <span class="step-number">2</span>
                    <span class="step-check">✓</span>
                </div>
                <div class="step-label">פרטי השקעה</div>
                <div class="step-time">כ-3 דקות</div>
            </div>
            <div class="step completed" data-step="3">
                <div class="step-circle">
                    <span class="step-number">3</span>
                    <span class="step-check">✓</span>
                </div>
                <div class="step-label">שאלון סיכון</div>
                <div class="step-time">כ-5 דקות</div>
            </div>
            <div class="step active" data-step="4">
                <div class="step-circle">
                    <span class="step-number">4</span>
                    <span class="step-check">✓</span>
                </div>
                <div class="step-label">הצהרות</div>
                <div class="step-time">כ-3 דקות</div>
            </div>
        </div>
    </div>

    <!-- Form Content -->
    <main class="form-content">
        <!-- Declarations Header & Progress -->
        <div class="declarations-header">
            <h2>הצהרות והסכמות</h2>
            <p class="legal-notice">
                נא לקרוא בעיון את ההצהרות הבאות. פתיחה וקריאה של כל נושא תיחשב כהסכמה לתוכנו.
                יש לקרוא את כל ההצהרות על מנת להמשיך לשלב החתימה.
            </p>
            <div class="progress-markers">
                <div class="progress-marker" data-declaration="declaration1">
                    <div class="marker-circle"></div>
                    <div class="marker-label">הצהרת סיכונים</div>
                </div>
                <div class="progress-marker" data-declaration="declaration2">
                    <div class="marker-circle"></div>
                    <div class="marker-label">החלטה עצמאית</div>
                </div>
                <div class="progress-marker" data-declaration="declaration3">
                    <div class="marker-circle"></div>
                    <div class="marker-label">עדכון פרטים</div>
                </div>
            </div>
        </div>

        <form id="section4-form" class="form-section">
            <!-- Declarations Accordion -->
            <div class="accordion-container">
                <!-- הצהרה 1 -->
                <div class="accordion-item" data-declaration="declaration1">
                    <button type="button" class="accordion-header">
                        <span class="accordion-title">הצהרת הבנת סיכונים</span>
                        <span class="accordion-icon">▼</span>
                    </button>
                    <div class="accordion-content">
                        <p class="mb-4">
                            אני מצהיר/ה בזאת כי הובהר לי שההשקעה במוצרים מובנים כרוכה בסיכונים מיוחדים, לרבות:
                        </p>
                        <ul class="declaration-list">
                            <li>סיכון לאובדן חלק או כל הקרן המושקעת</li>
                            <li>סיכוני שוק ותנודתיות</li>
                            <li>סיכוני נזילות ואפשרות מוגבלת למכירה לפני מועד הפירעון</li>
                            <li>סיכוני מטבע ושערי חליפין במידה ורלוונטי</li>
                            <li>תלות בחוסנם הפיננסי של מנפיקי המוצרים המובנים</li>
                            <li>מורכבות המוצרים והקושי בהערכת שווים</li>
                        </ul>
                        <label class="checkbox-container mt-4">
                            <input type="checkbox" name="riskAcknowledgement" required>
                            <span class="checkmark"></span>
                            קראתי והבנתי את כל הסיכונים המפורטים לעיל
                        </label>
                    </div>
                </div>

                <!-- הצהרה 2 -->
                <div class="accordion-item" data-declaration="declaration2">
                    <button type="button" class="accordion-header">
                        <span class="accordion-title">הצהרת אי הסתמכות והחלטה עצמאית</span>
                        <span class="accordion-icon">▼</span>
                    </button>
                    <div class="accordion-content">
                        <p class="mb-4">
                            אני מצהיר/ה בזאת כי:
                        </p>
                        <ul class="declaration-list">
                            <li>ההחלטה להשקיע במוצרים מובנים התקבלה על פי שיקול דעתי העצמאי בלבד</li>
                            <li>איני מסתמך/ת על עצות או המלצות של החברה או מי מטעמה</li>
                            <li>הובהר לי שהחברה אינה משמשת כיועץ השקעות ואינה מספקת ייעוץ אישי</li>
                            <li>בדקתי את התאמת ההשקעה לצרכיי ולמטרותיי הפיננסיות</li>
                            <li>אני מבין/ה שביצועי עבר אינם מעידים על ביצועים עתידיים</li>
                        </ul>
                        <label class="checkbox-container mt-4">
                            <input type="checkbox" name="independentDecision" required>
                            <span class="checkmark"></span>
                            אני מאשר/ת את כל ההצהרות הנ"ל
                        </label>
                    </div>
                </div>

                <!-- הצהרה 3 -->
                <div class="accordion-item" data-declaration="declaration3">
                    <button type="button" class="accordion-header">
                        <span class="accordion-title">התחייבות לעדכון פרטים</span>
                        <span class="accordion-icon">▼</span>
                    </button>
                    <div class="accordion-content">
                        <p>
                            אני מתחייב/ת בזאת:
                        </p>
                        <ul class="declaration-list">
                            <li>לעדכן את החברה בכתב על כל שינוי מהותי בפרטים שמסרתי בטופס זה</li>
                            <li>להודיע מיידית על כל שינוי במצבי הפיננסי שעשוי להשפיע על השקעותיי</li>
                            <li>לעדכן על שינויים בנסיבות האישיות שעשויים להשפיע על פרופיל הסיכון שלי</li>
                            <li>להודיע על שינויים במטרות ההשקעה או באופק ההשקעה המתוכנן</li>
                        </ul>
                        <p class="mt-4">
                            ידוע לי כי אי עדכון פרטים עלול לפגוע בהתאמת השירות לצרכיי ובאיכות השירות שאקבל.
                        </p>
                        <label class="checkbox-container mt-4">
                            <input type="checkbox" name="updateCommitment" required>
                            <span class="checkmark"></span>
                            אני מתחייב/ת לעדכן על כל שינוי מהותי כמפורט לעיל
                        </label>
                    </div>
                </div>
            </div>

            <!-- Digital Signature -->
            <div class="signature-section mt-6">
                <h3>חתימה דיגיטלית</h3>
                <div class="text-sm text-gray-600 mb-4">נא לחתום להסכמה על כל ההצהרות הנ"ל</div>
                
                <canvas id="signatureCanvas" class="signature-pad"></canvas>
                <div class="signature-controls">
                    <button type="button" id="clearSignature" class="btn-secondary">נקה חתימה</button>
                    <button type="button" id="copySignature" class="btn-secondary">העתק חתימה קודמת</button>
                    <input type="hidden" id="signatureData" name="finalSignature">
                </div>
            </div>

            <!-- Final Confirmation -->
            <div class="final-confirmation mt-6">
                <label class="checkbox-container">
                    <input type="checkbox" name="finalConfirmation" required disabled>
                    <span class="checkmark"></span>
                    <span class="text-bold">
                        אני מאשר/ת שקראתי והבנתי את כל ההצהרות לעיל, ומסכים/ה להן באופן מלא ובלתי חוזר
                    </span>
                </label>
            </div>
        </form>
    </main>

    <!-- Navigation -->
    <footer class="form-navigation">
        <div class="container">
            <button type="button" id="btnBack" class="btn-prev">חזור</button>
            <button type="button" id="finalSubmit" class="btn-next" disabled>סיים והגש טופס</button>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.min.js"></script>
    <script src="../../js/navigation.js"></script>
    <script src="../../js/storage.js"></script>
    <script src="../../js/validation.js"></script>
    <script src="../../js/accordion.js"></script>

    <script>
        // אתחול ה-SignaturePad
        const canvas = document.getElementById('signatureCanvas');
        const signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'white',
            penColor: 'black'
        });

        // התאמת גודל הקנבס
        function resizeCanvas() {
            const ratio =  Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            signaturePad.clear();
        }

        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        // כפתורי החתימה
        document.getElementById('clearSignature').addEventListener('click', () => {
            signaturePad.clear();
        });

        document.getElementById('copySignature').addEventListener('click', () => {
            const previousSignature = localStorage.getItem('signature');
            if (previousSignature) {
                signaturePad.fromDataURL(previousSignature);
            }
        });

        // עדכון תצוגת התקדמות ההצהרות
        function updateDeclarationProgress() {
            let allChecked = true;
            document.querySelectorAll('.accordion-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const declarationId = item.dataset.declaration;
                const marker = document.querySelector(`.progress-marker[data-declaration="${declarationId}"]`);
                
                if (checkbox.checked) {
                    marker.classList.add('completed');
                } else {
                    marker.classList.remove('completed');
                    allChecked = false;
                }
            });

            // עדכון כפתור האישור הסופי
            const finalConfirmation = document.querySelector('input[name="finalConfirmation"]');
            finalConfirmation.disabled = !allChecked;
            
            if (allChecked) {
                finalConfirmation.closest('.final-confirmation').classList.add('enabled');
            } else {
                finalConfirmation.closest('.final-confirmation').classList.remove('enabled');
            }
        }

        // מעקב אחר שינויים בתיבות הסימון
        document.querySelectorAll('.accordion-item input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateDeclarationProgress);
        });

        // מעקב אחר אישור סופי
        document.querySelector('input[name="finalConfirmation"]').addEventListener('change', function() {
            document.getElementById('finalSubmit').disabled = !this.checked;
        });

        // פתיחת אקורדיון אוטומטית כשמגיעים אליו
        document.querySelectorAll('.accordion-header').forEach(header => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !header.classList.contains('opened')) {
                        setTimeout(() => header.click(), 500);
                    }
                });
            }, { threshold: 0.5 });
            
            observer.observe(header);
        });
    </script>
</body>
</html>
